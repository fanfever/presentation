<!DOCTYPE html>
<html lang="en">
<head>
    <title>Microservices Brainstorming</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../slides_style/shower/themes/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }

        .small {
            font-size: 60%
        }

        .microsmall {
            font-size: 30%
        }

        #cover h2 {
            margin: 30px 0 0;
            color: white;
            text-align: center;
            font-size: 70px;
        }

        #cover p {
            margin: 10px 0 0;
            text-align: center;
            color: white;
            font-style: italic;
            font-size: 20px;
        }

        #cover p a {
            color: white;
        }
    </style>
</head>
<body class="shower list">

<header class="caption">
    <h1>Microservices Brainstorming</h1>
    <p>fanfever, Udesk Inc.</p>
</header>

<section class="slide" id="cover">
    <h2>Microservices Brainstorming</h2>
    <p>Brought to you by <a href="https://github.com/fanfever/presentation">fanfever</a></p>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/cover.jpg" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right white">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">目的</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>系统架构遵循的标准&业务驱动力</h2>
        <ol>
            <li>提高敏捷性：及时响应业务需求，促进企业发展</li>
            <li>提升客户体验：提升客户体验，减少客户流失</li>
            <li>降低成本：降低增加产品，客户或业务方案的成本</li>
        </ol>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>拥抱变化</h2>
        <ul>
            <li>软件开发流程和实践
                <ul>
                    <li class="next">敏捷开发（XP，Scrum，精益，看板）</li>
                </ul>
            </li>
            <li>软件技术和架构
                <ul>
                    <li class="next">SOA，Frontend–Backend，Microservices，SPA，HTTP/2，Container</li>
                </ul>
            </li>
        </ul>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <div style="width: 100%;height: 400px;overflow-y: auto;">
            <svg xmlns="http://www.w3.org/2000/svg" width="439" height="1798" style="margin: 0 auto;display: block;">
                <image href="2019-06-18_mb_pictures/timeline.svg"></image>
            </svg>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">系统架构演进</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Monolithic</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/monolithic_architecture.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>优劣</h2>
        <div class="small">
            <li>优势
                <ul>
                    <li>开发简单，集中式管理</li>
                    <li>基本不会重复开发</li>
                    <li>功能都在本地，没有分布式的管理和调用消耗</li>
                </ul>
            </li>
            <li>劣势
                <ul>
                    <li>效率低：开发都在同一个项目改代码，相互等待，冲突不断</li>
                    <li>维护难：代码功功能耦合在一起，新人不知道何从下手</li>
                    <li>不灵活：构建时间长，任何小修改都要重构整个项目，耗时</li>
                    <li>稳定性差：一个微小的问题，都可能导致整个应用挂掉</li>
                    <li>扩展性不够：无法满足高并发下的业务需求</li>
                </ul>
            </li>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">SOA</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>SOA</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/soa_architecture.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>ESB</h2>
        <div>
            <ul>
                <li>服务的虚拟化,支持虚拟化通讯参与方之间的服务交互并对其进行管理</li>
                <li>服务的转化,包装以及桥接</li>
                <li>消息的传递,过滤以及路由</li>
                <li>服务编制</li>
            </ul>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Microservices</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>什么是microservices</h2>
        <div class="small">
            <figure>
                <blockquote>
                    <p>In short, the microservice architectural style is an approach to developing a single application
                        as a
                        suite of
                        <mark>small</mark>
                        services, each running in its own process and communicating with lightweight
                        mechanisms,
                        often an HTTP resource API. These services are built around business capabilities and
                        <mark>independently
                            deployable
                        </mark>
                        by fully
                        <mark>automated deployment</mark>
                        machinery.
                    </p>
                </blockquote>
                <figcaption>James Lewis and Martin Fowler</figcaption>
            </figure>
            <figure>
                <blockquote>
                    <p>
                        简而言之，微服务架构风格是一种将单个应用程序开发为一套小型服务的方法，每个小型服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）进行通信。这些服务围绕业务功能构建，可通过全自动部署机制独立部署。</p>
                </blockquote>
                <figcaption>詹姆斯·里维斯，马丁·福勒</figcaption>
            </figure>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>


<section class="slide">
    <h2>microservices</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/microservices_architecture.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>优劣</h2>
        <div class="small">
            <li>优势
                <ul>
                    <li>强模块化边界</li>
                    <li>可独立部署</li>
                    <li>技术多样性</li>
                </ul>
            </li>
            <li>劣势
                <ul>
                    <li>分布式复杂性</li>
                    <li>最终一致性</li>
                    <li>运维复杂性</li>
                    <li>测试复杂性</li>
                </ul>
            </li>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Service Mesh</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>现有微服务的问题</h2>
        <div>
            <ul>
                <li>技术门槛高</li>
                <li>多语言支持不足</li>
                <li>代码侵入性强</li>
            </ul>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>什么是Service Mesh</h2>
        <div class="small">
            <figure>
                <blockquote>
                    <p>A service mesh is a dedicated <mark>infrastructure layer</mark> for handling <mark>service-to-service communication</mark>.
                        It’s responsible for the reliable delivery of requests through the complex topology of services
                        that
                        comprise a modern, cloud native application. In practice, the service mesh is typically
                        implemented
                        as an array of <mark>lightweight network proxies</mark> that are deployed alongside application code, without
                        the
                        application needing to be aware.</p>
                </blockquote>
                <figcaption>William Morgan</figcaption>
            </figure>
            <figure>
                <blockquote>
                    <p>
                        Service Mesh 是一个基础设施层，用于处理服务间通信。云原生应用有着复杂的服务拓扑，Service Mesh 保证请求可以在这些拓扑中可靠地穿梭。在实际应用当中，Service
                        Mesh
                        通常是由一系列轻量级的网络代理组成的，它们与应用程序部署在一起，但应用程序不需要知道它们的存在。</p>
                </blockquote>
                <figcaption>威廉·摩根</figcaption>
            </figure>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/service_mesh.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Service Mesh</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/service_mesh_2.webp"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">服务注册发现</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>概念</h2>
        <p>微服务实例的网络位置发生变化是一种常态</p>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>服务发现机制</h2>
        <table class="small">
            <tr>
                <th scope="col">客户端模式</th>
                <th scope="col">服务端模式</th>
            </tr>
            <tr>
                <td>只需要周期性获取列表，在调用服务时可以直接调用少了一个RT。但需要在每个客户端维护获取列表的逻辑</td>
                <td>简单，不需要在客户端维护获取服务列表的逻辑</td>
            </tr>
            <tr>
                <td>可用性高，即使注册中心出现故障也能正常工作</td>
                <td>可用性由路由器中间件决定，路由中间件故障则所有服务不可用，同时，由于所有调度以及存储都由中间件服务器完成，中间件服务器可能会面临过高的负载</td>
            </tr>
            <tr>
                <td>服务上下线对调用方有影响（会出现短暂调用失败）</td>
                <td>服务上下线调用方无感知</td>
            </tr>
        </table>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">主流方案对比</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/microservices_diff.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Zookeeper&Dubbo</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Zookeeper</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/zookeeper.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Dubbo</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/dubbo_architecture.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Eureka&Spring Cloud</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Eureka</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/eureka.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>Spring Cloud</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/spring_cloud.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">coreNDS&Kubernetes</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <h2>coreDNS</h2>
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/coreDNS&k8s.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Envoy&Istio</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide clear">
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/envoy.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide clear">
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/istio_arch.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide clear">
    <figure>
        <img class="cover" src="2019-06-18_mb_pictures/dark_lanch.png" alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">Pseudocode</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide microsmall">
    <figure>
        <pre><code>
<span class="comment"># create new namespace</span>
kubectl create ns udesk

<span class="comment"># deploy robot</span>
kubectl apply -f <(istioctl kube-inject -f robot/deployment.yml) -n udesk

<span class="comment"># deploy km</span>
kubectl apply -f <(istioctl kube-inject -f km/deployment-v1.yml) -n udesk
kubectl apply -f <(istioctl kube-inject -f km/deployment-v2.yml) -n udesk

<span class="comment"># 切换流量</span>
istioctl create -f istiofiles/route-rule-robot.yml -n udesk
            </code></pre>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide microsmall">
    <figure>
        <pre><code>
<span class="comment"># route-rule-robot-v1.yml</span>
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: robot
spec:
  hosts:
  - robot
  http:
  - route:
    - destination:
        host: robot
        subset: version-v1
        <mark>weight: 99</mark>
    - destination:
        host: robot
        subset: version-v2
        <mark>weight: 1</mark>
---
            </code></pre>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">什么时候引入微服务</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2>康威定律</h2>
        <div class="small">
            <figure>
                <blockquote>
                    <p>Any organization that design a system (defined broadly) will produce a design whose structure is
                        a
                        copy of the organization’s communication structure.</p>
                </blockquote>
                <figcaption>Melvin Conway</figcaption>
            </figure>
            <figure>
                <blockquote>
                    <p>
                        设计系统的架构受制于产生这些设计的组织的沟通结构。</p>
                </blockquote>
                <figcaption>梅尔文·康威</figcaption>
            </figure>
        </div>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide">
    <figure>
        <h2 class="shout">DDD</h2>
        <figcaption class="copyright right black">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<section class="slide clear">
    <figure>
        <img class="cover w h" src="2019-06-18_mb_pictures/wordcloud.png"
             alt="Hands on the orange typewriter in a park">
        <figcaption class="copyright right white">
            <a href="https://github.com/fanfever/presentation">© udesk</a>
        </figcaption>
    </figure>
</section>

<footer class="badge">
    <a href="https://github.com/fanfever/presentation/blob/master/brainstorming/2019-06-18_microservices-brainstorming.html">Edit
        me on GitHub</a>
</footer>

<div class="progress"></div>

<script src="../slides_style/shower/shower.min.js"></script>
<!-- Copyright © 3000 Yours Truly, Famous Inc. -->

</body>
</html>
